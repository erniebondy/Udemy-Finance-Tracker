<%= render "layouts/messages" %>

<% if @stock %>
  <div class="card">
    <div class="card-body">
      <h5 class="card-title"><%= @stock.name %></h5>
      <p class="card-text">
        Ticker: <%= @stock.ticker %> : $<%= @stock.last_price %>  
      </p>
      <!-- Pass in variables to the user_stocks_path -->
      <!-- These variables are read by the controller through the params -->
      <!-- You can't pass 'objects', only primitives -->
      <% if current_user.can_track_stock?(@stock.ticker) %>
        <%= link_to "Add to portfolio", user_stocks_path(user: current_user, ticker: @stock.ticker ), 
                                        data: { turbo_method: :post },
                                        class: "btn btn-success" %>
      <% else %>
        <span class="badge text-bg-secondary">
          You already tracking 
          <% if !current_user.under_stock_limit? %>
            10 stocks!
          <% elsif current_user.stock_already_tracked?(@stock.ticker) %>
            this stock!
          <% end %>
        </span>
      <% end %>
    </div>
  </div>
<% end %>