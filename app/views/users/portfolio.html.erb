<h1>Portfolio</h1>

<div class="search-area pt-4">
  
  <h3>Search stocks</h3>

  <!-- We will submit the form via ajax -->
  <!-- Set remote= true -->

  <!-- 
  <form action="search_stock" method="get" data-remote="true">
    <input type="text" name="stock" id="text1" placeholder="Stock ticker symbol">
  </form>
  -->

  <%= form_tag search_stock_path, method: :get, data: { turbo: false, remote: true } do %>
    <div class="form-group row">
      <div class="col-sm-9 pe-1 pb-2">
        <%= text_field_tag :stock, params[:stock], placeholder: "Stock ticker symbol", 
                                   autofocus: true, class: "form-control form-control-lg" %>
      </div>
      <div class="col-sm-3 ps-1">
        <%= button_tag class: "btn btn-success" do %>
          <i class="bi bi-search"></i> <%= "Search" %>
        <% end %>
      </div>
    </div>
  <% end %>

</div>

<%#= render "users/result" %>
<div class="col-sm-9">
  <div id="results" class="pb-4">
    
  </div>

  <% if !current_user.stocks.empty? %>
    <table class="table table-hover">
      <thead>
        <tr>
          <th scope="col">Ticker</th>
          <th scope="col">Name</th>
          <th scope="col">Price</th>
          <th scope="col">Action</th>
        </tr>
      </thead>
      <tbody>
        <% current_user.stocks.each do |stock| %>
          <tr>
            <td><%= stock.ticker %></td>
            <td><%= stock.name %></td>
            <td><%= stock.last_price %></td>
            <td><%= link_to "Remove", user_stock_path(stock), data: { turbo_method: :delete, confirm: "Are you sure?" },
                                      class: "btn btn-outline-warning" %></td>
          </tr>
        <% end %>
      </tbody>
    </table>
  <% end %>

</div>